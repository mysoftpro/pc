# -*- coding: utf-8 -*-
from twisted.web.xmlrpc import Proxy
import base64
from twisted.python import log
import sys
from cStringIO import StringIO
import gzip
from twisted.web.resource import Resource

class XmlGetter(Resource):
    def pr(self, res):
        log.startLogging(sys.stdout)
        src = base64.decodestring(res)
        sio = StringIO(src)
        gz = gzip.GzipFile(fileobj=sio)
        f = open('/home/aganzha/xmlrpc.txt', 'w')
        f.write(gz.read())
        f.close()
        
    def render_GET(self, request):
        proxy = Proxy('http://wit-tech.ru/xml')
        proxy.callRemote('xmlcatalog.get', 'aganzha@yandex.ru', '12345').addCallbacks(self.pr, self.pr)
        return "ok"

